Native = ${Benchmark}
WASM = ${Benchmark}.wasm

SRC = $(wildcard ${SRCDIR}/*.${SRCSUFFIX})
OBJ = $(SRC:.${SRCSUFFIX}=.o)

CLANG=clang-15

ifeq (${SRCSUFFIX}, $(filter ${SRCSUFFIX}, cc cpp))
    CLANG=clang++-15
endif

CC=${CLANG}

OPT=-O2

WASMCC=${CLANG} --target=wasm32-unknown-wasi --sysroot=${WASI_SYSROOT}

all: ${Native} ${WASM}

%.o: %.${SRCSUFFIX}
	${CC} ${CFLAGS} ${OPT} ${CINCLUDE} -c $< -o $@

${Native}: ${OBJ}
	${CC} ${CFLAGS} ${OPT} $^ ${LDFLAGS} -o $@

${WASM}: ${SRC}
	${WASMCC} ${CFLAGS} ${OPT} ${CINCLUDE} ${WASM_LDFLAGS} $^ -o $@

clean:
	@echo "Cleaning up..."
	rm -rf ${OBJ} ${Native} ${WASM} ${TEMPFILE} *.cwasm output_*
